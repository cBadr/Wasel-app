{% extends "base.html" %}

{% block header_title %}ุฅุนุฏุงุฏุงุช ุชูุจููุงุช ุชููุฌุฑุงู{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-bottom-0 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-primary fw-bold"><i class="fab fa-telegram me-2"></i> ุฅุนุฏุงุฏุงุช ุงูุจูุช ูุงูุชูุจููุงุช</h5>
                    <a href="{{ url_for('settings') }}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> ุงูุนูุฏุฉ ููุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ
                    </a>
                </div>
            </div>
            <div class="card-body">
                <form method="POST">
                    <fieldset {% if not current_user.can('settings', 'edit') %}disabled{% endif %}>
                    
                    <div class="alert alert-light border shadow-sm mb-4">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-info-circle text-info fa-2x"></i>
                            </div>
                            <div>
                                <h6 class="fw-bold">ููููุฉ ุงูุฅุนุฏุงุฏ</h6>
                                <p class="mb-0 small text-muted">
                                    1. ุฃูุดุฆ ุจูุช ุฌุฏูุฏ ุนุจุฑ ูุฑุงุณูุฉ <a href="https://t.me/BotFather" target="_blank" class="text-decoration-none">@BotFather</a> ููุญุตูู ุนูู <strong>Bot Token</strong>.<br>
                                    2. ุงุจุฏุฃ ูุญุงุฏุซุฉ ูุน ุงูุจูุช ุงูุฎุงุต ุจู.<br>
                                    3. ุงุญุตู ุนูู <strong>Chat ID</strong> ุงูุฎุงุต ุจู ุนุจุฑ ูุฑุงุณูุฉ <a href="https://t.me/userinfobot" target="_blank" class="text-decoration-none">@userinfobot</a>.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="telegram_bot_token" class="form-label fw-bold">ุชููู ุงูุจูุช (Bot Token)</label>
                            <input type="text" class="form-control" id="telegram_bot_token" name="telegram_bot_token" value="{{ settings.telegram_bot_token or '' }}" placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz">
                        </div>
                        <div class="col-md-6">
                            <label for="telegram_chat_id" class="form-label fw-bold">ูุนุฑู ุงููุญุงุฏุซุฉ (Chat ID)</label>
                            <input type="text" class="form-control" id="telegram_chat_id" name="telegram_chat_id" value="{{ settings.telegram_chat_id or '' }}" placeholder="123456789">
                        </div>
                    </div>

                    <h5 class="mb-3 text-primary border-bottom pb-2 mt-4">
                        <i class="fas fa-bell me-2"></i> ุฎูุงุฑุงุช ุงูุชูุจููุงุช
                    </h5>
                    
                    <div class="row mb-3 bg-light p-3 rounded mx-0">
                        <div class="col-md-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="telegram_notify_start_stop" name="telegram_notify_start_stop" {% if settings.telegram_notify_start_stop %}checked{% endif %}>
                                <label class="form-check-label fw-bold" for="telegram_notify_start_stop">ุชูุจูู ุนูุฏ ุจุฏุก/ุฅููุงู/ุงูุชูุงุก ุงูุญููุฉ</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="telegram_notify_progress" name="telegram_notify_progress" {% if settings.telegram_notify_progress %}checked{% endif %}>
                                <label class="form-check-label fw-bold" for="telegram_notify_progress">ุชูุจูู ุฏูุฑู ููุณุจุฉ ุงูุชูุฏู</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="telegram_notify_each_call" name="telegram_notify_each_call" {% if settings.telegram_notify_each_call %}checked{% endif %}>
                                <label class="form-check-label fw-bold" for="telegram_notify_each_call">ุชูุจูู ุนูุฏ ุงูุชูุงุก ูู ููุงููุฉ</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label for="telegram_notify_interval" class="form-label fw-bold">ูุงุตู ุงูุชูุจูู ุงูุฏูุฑู (ุฏูุงุฆู)</label>
                            <input type="number" class="form-control" id="telegram_notify_interval" name="telegram_notify_interval" value="{{ settings.telegram_notify_interval }}">
                        </div>
                    </div>

                    <h5 class="mb-3 text-primary border-bottom pb-2 mt-4">
                        <i class="fas fa-file-alt me-2"></i> ููุงูุจ ุงูุฑุณุงุฆู (Templates)
                    </h5>
                    
                    <div class="alert alert-secondary small mb-3">
                        <strong>ุงููุชุบูุฑุงุช ุงููุชุงุญุฉ ููุงุณุชุฎุฏุงู ูู ุงูููุงูุจ:</strong><br>
                        <code>{campaign_name}</code> ุงุณู ุงูุญููุฉ | 
                        <code>{campaign_id}</code> ุฑูู ุงูุญููุฉ | 
                        <code>{total_contacts}</code> ุฅุฌูุงูู ุงูุฃุฑูุงู | 
                        <code>{dialed}</code> ุชู ุงูุงุชุตุงู | 
                        <code>{answered}</code> ุชู ุงูุฑุฏ | 
                        <code>{progress}</code> ูุณุจุฉ ุงูุชูุฏู %
                    </div>

                    <div class="mb-3">
                        <label for="telegram_template_start" class="form-label fw-bold">ูุงูุจ ุฑุณุงูุฉ ุจุฏุก ุงูุญููุฉ</label>
                        <textarea class="form-control" id="telegram_template_start" name="telegram_template_start" rows="2">{{ settings.telegram_template_start or '๐ ุชู ุจุฏุก ุงูุญููุฉ: {campaign_name}\nุนุฏุฏ ุงูุฃุฑูุงู: {total_contacts}' }}</textarea>
                    </div>

                    <div class="mb-3">
                        <label for="telegram_template_finish" class="form-label fw-bold">ูุงูุจ ุฑุณุงูุฉ ุงูุชูุงุก ุงูุญููุฉ</label>
                        <textarea class="form-control" id="telegram_template_finish" name="telegram_template_finish" rows="2">{{ settings.telegram_template_finish or 'โ ุงูุชููุช ุงูุญููุฉ: {campaign_name}\n๐ ุงููุชุงุฆุฌ:\nุชู ุงูุฑุฏ: {answered}/{dialed}' }}</textarea>
                    </div>

                    <div class="mb-3">
                        <label for="telegram_template_progress" class="form-label fw-bold">ูุงูุจ ุฑุณุงูุฉ ุงูุชูุฏู ุงูุฏูุฑู</label>
                        <textarea class="form-control" id="telegram_template_progress" name="telegram_template_progress" rows="2">{{ settings.telegram_template_progress or '๐ ุชูุฑูุฑ ุงูุชูุฏู - {campaign_name}\nูุณุจุฉ ุงูุฅูุฌุงุฒ: {progress}%' }}</textarea>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4 pt-3 border-top">
                        {% if current_user.can('settings', 'edit') %}
                        <a href="{{ url_for('test_telegram') }}" class="btn btn-outline-info px-4 me-2">
                            <i class="fab fa-telegram-plane me-2"></i> ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
                        </a>
                        <button type="submit" class="btn btn-primary px-5">
                            <i class="fas fa-save me-2"></i> ุญูุธ ุงูุชุบููุฑุงุช
                        </button>
                        {% endif %}
                    </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
